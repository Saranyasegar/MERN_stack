<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <style>
        /* =========================================
       1. CSS Variables & Theme Setup
       ========================================= */
        :root {
            /* Light Theme Variables */
            --bg-body: #f4f6f8;
            --bg-card: #ffffff;
            --text-main: #333333;
            --text-secondary: #666666;
            --primary: #6c5ce7;
            --primary-hover: #5b4cc4;
            --danger: #ff7675;
            --danger-hover: #d63031;
            --success: #00b894;
            --border-color: #dfe6e9;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --modal-overlay: rgba(0, 0, 0, 0.5);
            --input-bg: #ffffff;
        }

        /* Dark Theme Variables */
        [data-theme="dark"] {
            --bg-body: #2d3436;
            --bg-card: #353b48;
            --text-main: #f5f6fa;
            --text-secondary: #b2bec3;
            --primary: #a29bfe;
            --primary-hover: #6c5ce7;
            --danger: #ff7675;
            --danger-hover: #d63031;
            --success: #55efc4;
            --border-color: #4b5563;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --modal-overlay: rgba(0, 0, 0, 0.7);
            --input-bg: #2d3436;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 40px 20px;
        }

        /* =========================================
       2. Main Container
       ========================================= */
        .container {
            background-color: var(--bg-card);
            width: 100%;
            max-width: 600px;
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        #theme-toggle {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-main);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
        }

        #theme-toggle:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* =========================================
       3. Controls (Search & Clear)
       ========================================= */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #search {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text-main);
            outline: none;
        }

        #search:focus {
            border-color: var(--primary);
        }

        #clear-completed {
            background-color: transparent;
            color: var(--danger);
            border: 2px solid var(--danger);
            padding: 0 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        #clear-completed:hover {
            background-color: var(--danger);
            color: white;
        }

        /* =========================================
       4. Input Section
       ========================================= */
        #note-form {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        #note-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text-main);
            font-size: 1rem;
            outline: none;
        }

        #note-input:focus {
            border-color: var(--primary);
        }

        button[type="submit"] {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
        }

        button[type="submit"]:hover {
            background-color: var(--primary-hover);
        }

        /* =========================================
       5. Notes List
       ========================================= */
        #notes-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .note {
            background-color: var(--bg-card);
            /* Default, overridden by inline style */
            border: 1px solid var(--border-color);
            padding: 16px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .note:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .note.dragging {
            opacity: 0.5;
            background-color: var(--border-color);
            cursor: grabbing;
        }

        .note.completed .text {
            text-decoration: line-through;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .note .text {
            flex: 1;
            margin-right: 15px;
            word-break: break-all;
        }

        .edit-input {
            flex: 1;
            margin-right: 15px;
            padding: 8px;
            border: 1px solid var(--primary);
            border-radius: 4px;
            font-size: 1rem;
        }

        /* =========================================
       6. Note Actions
       ========================================= */
        .actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
        }

        .btn-complete {
            background-color: var(--success);
        }

        .btn-delete {
            background-color: var(--danger);
        }

        .color-picker {
            width: 30px;
            height: 30px;
            padding: 0;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            background: none;
        }

        .color-picker::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 50%;
            border: 2px solid var(--border-color);
        }

        /* =========================================
       7. Modal
       ========================================= */
        #modal {
            display: none;
            /* Toggled by JS to flex */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-overlay);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .modal-content {
            background-color: var(--bg-card);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-content p {
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: var(--text-main);
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        #modal-yes {
            background-color: var(--danger);
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        #modal-no {
            background-color: transparent;
            border: 2px solid var(--text-secondary);
            color: var(--text-secondary);
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1>Task Manager</h1>
            <button id="theme-toggle">Dark Mode</button>
        </header>

        <div class="controls">
            <input type="text" id="search" placeholder="Search notes..." />
            <button id="clear-completed">Clear Completed</button>
        </div>

        <form id="note-form">
            <input type="text" id="note-input" placeholder="Add a new note..." autocomplete="off" />
            <button type="submit">Add</button>
        </form>

        <ul id="notes-list">
            <!-- Notes will be added here -->
        </ul>
    </div>

    <!-- Modal -->
    <div id="modal">
        <div class="modal-content">
            <p>Are you sure you want to delete all completed notes?</p>
            <div class="modal-actions">
                <button id="modal-yes">Yes, Delete</button>
                <button id="modal-no">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {

            // ===== Select elements =====
            const noteForm = document.getElementById("note-form");
            const noteInput = document.getElementById("note-input");
            const notesList = document.getElementById("notes-list");
            const searchInput = document.getElementById("search");
            const themeToggle = document.getElementById("theme-toggle");
            const clearCompletedBtn = document.getElementById("clear-completed");
            const modal = document.getElementById("modal");
            const modalYes = document.getElementById("modal-yes");
            const modalNo = document.getElementById("modal-no");

            let draggedItem = null;

            // ===== Add Note =====
            noteForm.addEventListener("submit", (e) => {
                e.preventDefault();

                const text = noteInput.value.trim();
                if (!text) return;

                const li = document.createElement("li");
                li.className = "note";
                li.draggable = true;

                // Default background override if needed, or let CSS handle it
                // For now, let's keep it transparent/default so themes work unless user picks color

                li.innerHTML = `
      <span class="text">${text}</span>

      <div class="actions">
        <input type="color" class="color-picker" value="#ffffff" />
        <button class="btn btn-complete">Complete</button>
        <button class="btn btn-delete">Delete</button>
      </div>
    `;

                notesList.prepend(li);
                noteInput.value = "";
            });

            // ===== Event Delegation for Complete / Delete / Color / Edit =====
            notesList.addEventListener("click", (e) => {
                const note = e.target.closest(".note");
                if (!note) return;

                // Delete
                if (e.target.matches(".btn-delete")) {
                    note.remove();
                }

                // Complete
                if (e.target.matches(".btn-complete")) {
                    note.classList.toggle("completed");
                }
            });

            // Change color
            notesList.addEventListener("change", (e) => {
                if (e.target.matches(".color-picker")) {
                    const note = e.target.closest(".note");
                    note.style.backgroundColor = e.target.value;

                    // smart styling: if color is dark, make text white (optional enhancement)
                    // but simplistic for now as requested
                }
            });

            // ===== Double click to edit =====
            notesList.addEventListener("dblclick", (e) => {
                if (!e.target.matches(".text")) return;

                const span = e.target;
                const oldText = span.textContent;

                const input = document.createElement("input");
                input.type = "text";
                input.value = oldText;
                input.className = "edit-input";

                span.replaceWith(input);
                input.focus();

                const save = () => {
                    const newSpan = document.createElement("span");
                    newSpan.className = "text";
                    newSpan.textContent = input.value.trim() || oldText;
                    input.replaceWith(newSpan);
                };

                input.addEventListener("blur", save);
                input.addEventListener("keydown", (e) => {
                    if (e.key === "Enter") input.blur();
                });
            });

            // ===== Drag & Drop =====
            notesList.addEventListener("dragstart", (e) => {
                draggedItem = e.target;
                // We need a slight delay or else the element disappears immediately from sight
                setTimeout(() => {
                    e.target.classList.add("dragging");
                }, 0);
            });

            notesList.addEventListener("dragend", (e) => {
                e.target.classList.remove("dragging");
                draggedItem = null;
            });

            notesList.addEventListener("dragover", (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(e.clientY);
                if (afterElement == null) {
                    notesList.appendChild(draggedItem);
                } else {
                    notesList.insertBefore(draggedItem, afterElement);
                }
            });

            function getDragAfterElement(y) {
                const elements = [...notesList.querySelectorAll(".note:not(.dragging)")];

                return elements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;

                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            // ===== Live Search =====
            searchInput.addEventListener("input", () => {
                const value = searchInput.value.toLowerCase();

                document.querySelectorAll(".note").forEach(note => {
                    const text = note.querySelector(".text").textContent.toLowerCase();
                    note.style.display = text.includes(value) ? "flex" : "none"; // Changed 'block' to 'flex' to maintain layout
                });
            });

            // ===== Theme Toggle =====
            themeToggle.addEventListener("click", () => {
                const html = document.documentElement;
                const isDark = html.dataset.theme === "dark";

                html.dataset.theme = isDark ? "light" : "dark";
                themeToggle.textContent = isDark ? "Dark Mode" : "Light Mode";
            });

            // ===== Modal Logic =====
            clearCompletedBtn.addEventListener("click", () => {
                modal.style.display = "flex";
            });

            modalNo.addEventListener("click", () => {
                modal.style.display = "none";
            });

            modalYes.addEventListener("click", () => {
                document.querySelectorAll(".note.completed").forEach(note => note.remove());
                modal.style.display = "none";
            });

            // Close modal when clicking outside box
            modal.addEventListener("click", (e) => {
                if (e.target === modal) modal.style.display = "none";
            });

        });
    </script>
    <script src="objectandarray.js"></script>
</body>

</html>